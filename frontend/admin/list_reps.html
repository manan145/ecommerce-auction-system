<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>List Customer Reps</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500|Montserrat:700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f0f4fa;
      padding: 40px;
    }

    h1 {
      text-align: center;
      color: #304ffe;
    }

    #create-rep-btn {
      display: block;
      margin: 20px auto;
      background-color: #304ffe;
      color: white;
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #304ffe;
      color: white;
    }

    tr:hover {
      background-color: #f5f8ff;
    }

    button.edit-btn {
      padding: 6px 12px;
      background-color: #17a2b8;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button.edit-btn:hover {
      background-color: #138496;
    }
  </style>
</head>
<body>
  <h1>Customer Representatives</h1>
  <button id="create-rep-btn">Create New Rep</button>

  <table id="reps-table">
    <thead>
      <tr>
        <th>RepID</th>
        <th>Username</th>
        <th>Email</th>
        <th>Department</th>
        <th>Shift</th>
        <th>Status</th>
        <th>Edit</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const BASE_URL = 'http://127.0.0.1:5000';
    const token = localStorage.getItem('token');
    const tableBody = document.querySelector('#reps-table tbody');

    document.getElementById('create-rep-btn').addEventListener('click', () => {
      window.location = 'create_rep.html';
    });

    async function loadReps() {
      try {
        const res = await fetch(`${BASE_URL}/admin/customer-reps`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const reps = await res.json();
        if (!res.ok) throw new Error(reps.error || 'Failed to fetch reps');

        tableBody.innerHTML = '';
        reps.forEach(rep => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${rep.RepID}</td>
            <td>${rep.Username}</td>
            <td>${rep.Email}</td>
            <td>${rep.Department}</td>
            <td>${rep.Shift}</td>
            <td>${rep.Status}</td>
          `;

          const editBtn = document.createElement('button');
          editBtn.classList.add('edit-btn');
          editBtn.textContent = 'Edit';
          editBtn.addEventListener('click', () => {
            window.location = `update_rep.html?rep_id=${rep.RepID}`;
          });

          const td = document.createElement('td');
          td.appendChild(editBtn);
          tr.appendChild(td);
          tableBody.appendChild(tr);
        });

      } catch (err) {
        alert(`‚ùå ${err.message}`);
      }
    }

    loadReps();
  </script>
</body>
</html>
